<div
  #board
  class="board"
  [class.isDragging]="isDragging"
  [class.board--grid]="grid"
  (contextmenu)="onRightClick($event)"
  (mousedown)="checkDragStart($event)"
  (mousemove)="checkDrag($event)"
  (mouseup)="checkDragStop($event)"
>
  <div
    #contextMenu
    class="contextMenu"
    [class.active]="contextMenuActive"
    [style.left.px]="contextMenuPosition.x"
    [style.top.px]="contextMenuPosition.y"
  >
    <header>
      <p>Create new node</p>
    </header>
    <li (click)="addNode($event, 'content')">Content node</li>
    <li (click)="addNode($event, 'distributor')">Distributor node</li>
    <li (click)="addNode($event, 'end')">End node</li>
  </div>

  <polo-board-flows
    [drawingFrom]="dragStartedOn"
    [drawingTo]="dragMouseOn"
  ></polo-board-flows>
  @if (activeStory.entireTree()) {
    <ng-container>
      @for (node of activeStory.entireTree().nodes; track node.id) {
        <polo-node
          #node
          cdkDrag
          id="{{ node.id }}"
          [nodeId]="node.id"
          [type]="node.type || 'content'"
          (click)="setActiveNode(node.id, activeStory.storyId())"
          (mousedown)="stopDragging()"
          (mouseenter)="mouseEnter($event)"
          (mouseleave)="mouseLeave($event)"
          (onWillJoin)="willJoin($event)"
          (haveJoined)="haveJoined($event)"
          (duplicateNode)="duplicateNode($event)"
          (removeNode)="removeNode($event)"
          (cdkDragStarted)="dragStarted($event)"
          (cdkDragReleased)="dragReleased($event)"
          (cdkDragMoved)="dragCheck()"
          [style.transform]="
            'translate3d(' + node.left + 'px, ' + node.top + 'px, 0px)'
          "
          [text]="node.text"
          [answers]="node.answers"
          [conditions]="node.conditions"
          [shareOptions]="node.share || {}"
          [image]="node.image?.path"
          [links]="node.links || []"
        >
          <dragHandle cdkDragHandle>
            <p>
              <span style="text-transform: capitalize">{{
                node.type || 'content'
              }}</span>
              node
            </p>
          </dragHandle>
        </polo-node>
      }
    </ng-container>
  }
</div>
